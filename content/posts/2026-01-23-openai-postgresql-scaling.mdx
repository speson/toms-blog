---
title: "OpenAI, 8억 명의 ChatGPT 사용자를 위한 PostgreSQL 스케일링 비법 공개"
description: "OpenAI가 PostgreSQL을 초당 수백만 건의 쿼리를 처리하도록 확장한 방법을 공개했습니다. 레플리카, 캐싱, 레이트 리미팅, 워크로드 분리 전략을 상세히 설명합니다."
date: "2026-01-23"
tags: ["AI", "OpenAI", "PostgreSQL", "인프라", "데이터베이스"]
source: "openai"
sourceUrl: "https://openai.com/index/scaling-postgresql"
category: "ai-news"
draft: false
---

## 요약

OpenAI가 **PostgreSQL을 초당 수백만 건의 쿼리(QPS)를 처리하도록 확장한 엔지니어링 노하우**를 공개했습니다. 단일 프라이머리 인스턴스와 약 50개의 읽기 레플리카로 8억 명의 사용자를 지원하는 아키텍처의 비밀을 상세히 설명합니다.

## 핵심 아키텍처

OpenAI의 PostgreSQL 구성:

- **단일 프라이머리** Azure PostgreSQL Flexible Server 인스턴스
- **약 50개의 읽기 레플리카** (전 세계 다중 리전 분산)
- 지난 1년간 **10배 이상의 부하 증가**에도 안정적 운영

## 주요 확장 전략

### 1. 프라이머리 부하 최소화

```
읽기 트래픽 → 레플리카로 오프로드
쓰기 집약 워크로드 → Azure CosmosDB로 마이그레이션
```

- 샤딩 가능한 쓰기 워크로드는 CosmosDB 등 샤드 시스템으로 이전
- 불필요한 쓰기 제거 및 지연 쓰기(lazy writes) 도입
- 새 테이블은 PostgreSQL에 추가 금지 → 샤드 시스템에 생성

### 2. 쿼리 최적화

| 문제                  | 해결책                                     |
| --------------------- | ------------------------------------------ |
| 12개 테이블 조인 쿼리 | 쿼리 분해 → 애플리케이션 레이어에서 조인   |
| ORM 생성 비효율 쿼리  | SQL 직접 검토 및 최적화                    |
| 장시간 유휴 쿼리      | `idle_in_transaction_session_timeout` 설정 |

### 3. 단일 장애점(SPOF) 완화

- **High-Availability 모드**: 핫 스탠바이로 빠른 페일오버
- 읽기 전용 요청은 프라이머리 다운시에도 레플리카에서 처리
- 리전당 충분한 레플리카 배치로 개별 레플리카 장애 대응

### 4. 워크로드 격리

"Noisy Neighbor" 문제 해결:

```
저우선순위 요청 → 전용 인스턴스
고우선순위 요청 → 별도 전용 인스턴스
```

제품/서비스별로도 동일한 격리 전략 적용

### 5. 커넥션 풀링

**PgBouncer** 프록시 레이어 도입:

- Statement/Transaction 풀링 모드로 커넥션 재사용
- 평균 연결 시간: **50ms → 5ms**로 단축
- 프록시, 클라이언트, 레플리카를 동일 리전에 배치하여 네트워크 오버헤드 최소화

### 6. 캐싱과 캐시 락킹

캐시 미스 폭풍 방지:

```
동일 키에 대한 다중 요청 발생 시:
→ 하나의 요청만 PostgreSQL 조회
→ 나머지는 캐시 갱신 대기
```

### 7. 레플리카 확장: 캐스케이딩 복제

현재 아키텍처:

```
프라이머리 → 모든 레플리카 (WAL 직접 전송)
```

개선 중:

```
프라이머리 → 중간 레플리카 → 다운스트림 레플리카
```

Azure PostgreSQL 팀과 협력하여 100개 이상 레플리카 확장 준비 중

## 성과

| 지표                   | 결과                               |
| ---------------------- | ---------------------------------- |
| QPS                    | 수백만 건/초                       |
| p99 레이턴시           | 10ms대 유지                        |
| 가용성                 | 99.999% (Five-nines)               |
| 지난 12개월 SEV-0 장애 | **1건** (ChatGPT ImageGen 출시 시) |

유일한 SEV-0 장애는 ChatGPT ImageGen 바이럴 출시 때 발생 — 1주일 만에 1억 명 이상 신규 가입으로 쓰기 트래픽 10배 급증

## 향후 계획

- 남은 쓰기 집약 워크로드 샤드 시스템으로 이전 진행 중
- 캐스케이딩 복제로 100개+ 레플리카 확장
- 장기적으로 샤딩된 PostgreSQL 또는 분산 시스템 검토

## 핵심 교훈

> "적절한 설계와 최적화를 통해 Azure PostgreSQL은 가장 큰 프로덕션 워크로드도 처리할 수 있습니다."

단일 프라이머리 아키텍처가 OpenAI 규모에서도 작동할 수 있다는 것을 증명한 사례입니다.

## 원문 링크

- [Scaling PostgreSQL to power 800 million ChatGPT users - OpenAI](https://openai.com/index/scaling-postgresql)
